<cp-repository-component #repo>
  <button class="add-app-button btn btn-primary btn-sm" (click)="repo.addApplicationFormShowing=!repo.addApplicationFormShowing">
    <span class="glyphicon glyphicon-plus"></span>
  </button>

  <div *ngIf="repo.addApplicationFormShowing">
    <form [formGroup]="repo.applicationForm" autocomplete="off">
      <h3>Add application</h3>
      <div class="form-group">
        <label for="inputUri" class="sr-only">URI</label>
        <input class="form-control" id="inputUri" 
          type="url" placeholder="Repository URI" [formControl]="repo.applicationForm.controls['repoUri']" autofocus>
      </div>
      <button type="submit" class="btn btn-default"
      [disabled]="repo.applicationForm.controls['repoUri'].hasError('required') || !repo.applicationForm.controls['repoUri'].valid"
      (click)="repo.addApplication(repo.applicationForm.value); repo.addApplicationFormShowing = false">Add</button>
    </form>
    <br/>
  </div>

  <accordion [closeOthers]="true" *ngIf="repo.applicationDeployers">

    <div *ngIf="repo.applicationDeployers.length==0">
      No applications registered yet
    </div>
    <!--Owned applications-->
    <accordion-group *ngFor="let applicationDeployer of repo.applicationDeployers | applicationCloudProvider:cloudProviderFilters" 
      [isOpen]="openOne==applicationDeployer.name"
      (click)="openOne=applicationDeployer.name"
      heading="{{ applicationDeployer.name }} v{{ applicationDeployer.version }}">
      <div class="row">
        <div class="col-md-12">
          <p class="lead">{{ applicationDeployer.about }}</p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <h5>Source</h5>
          <p><a href="{{ applicationDeployer.repoUri }}">{{ applicationDeployer.repoUri }}</a></p>
          <h5>Version</h5>
          <p>{{ applicationDeployer.version }}</p>
          <h5>Contact</h5>
          <p>{{ applicationDeployer.contact }}</p>       
        </div>
        <div class="col-md-4">
          <h5>Available for</h5>
          <p class="param-value" *ngFor="let cloudProvider of applicationDeployer.cloudProviders">
            {{ cloudProvider.cloudProvider }}
          </p>
        </div>
        <div class="col-md-4">
          <h5>Shared with <button
              class="btn btn-default btn-xs"
              (click)="shareApplicationDialogShowing=!shareApplicationDialogShowing">
              <span class="glyphicon glyphicon-plus"></span>
          </button></h5>
          <span *ngIf="shareApplicationDialogShowing">
            <form class="form-inline">
              <div class="form-group">
                <input placeholder="Share with (required)" [(ngModel)]="shareWith" name="shareWith" autofocus>
              </div>
              <button 
              type="submit" class="btn btn-default btn-sm"
              [disabled]="!shareWith || shareWith.length==0"
              (click)="repo.share(applicationDeployer, shareWith); shareApplicationDialogShowing = false">
              Share</button>
            </form>
          </span>
          <span *ngIf="!applicationDeployer.isShared && applicationDeployer.sharedWithAccountEmails.length>0">
            <p *ngFor="let accountEmail of applicationDeployer.sharedWithAccountEmails">
              <button
              class="btn btn-default btn-xs"
              (click)="repo.unshare(applicationDeployer, accountEmail)">
              <span class="glyphicon glyphicon-remove"></span>
            </button> {{ accountEmail }}</p>
          </span>

          <span *ngIf="applicationDeployer.sharedWithTeamNames && applicationDeployer.sharedWithTeamNames.length>0">
            <p *ngFor="let teamName of applicationDeployer.sharedWithTeamNames">
              <button *ngIf="!applicationDeployer.isShared"
              class="btn btn-default btn-xs"
              (click)="repo.unshare(applicationDeployer, teamName)">
                <span class="glyphicon glyphicon-remove"></span> 
              </button> {{ teamName }}
            </p>
          </span>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4">
          <h5>Volumes</h5>
          <p *ngIf="applicationDeployer.volumes.length==0">This application requires no data volumes</p>
          <div *ngFor="let aVolume of applicationDeployer.volumes">
            {{ aVolume }}
            <select class="form-control" 
              (change)="repo.attachVolume(applicationDeployer, aVolume, $event.target.value)">
              <option value="null">None</option>
              <option *ngFor="let volumeInstance of repo.volumeInstances">
                {{ volumeInstance.reference }}</option>
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <h5>Inputs</h5>
          <p *ngIf="applicationDeployer.inputs.length==0">This application defines no inputs</p>
          <div *ngFor="let anInput of applicationDeployer.inputs">
            <input class="form-control" 
              placeholder="{{anInput}}"
              (keyup.enter)="repo.assignInput(applicationDeployer, anInput, $event.target.value)"
              (blur)="repo.assignInput(applicationDeployer, anInput, $event.target.value)">
          </div>
        </div>
        <div class="col-md-4">
          <h5>Outputs</h5>
          <p *ngIf="applicationDeployer.outputs.length==0">This application defines no outputs</p>
          <div *ngFor="let anOutput of applicationDeployer.outputs">
            <p>{{anOutput}}</p>
          </div>
        </div> 
      </div>
      <br/>
      <div class="row">
      <div class="col-md-12">
        <div *ngIf="!applicationDeployer.deploying && !applicationDeployer.destroying">
          <alert type="warning" *ngIf="!repo.cloudProviderParametersService.currentlySelectedCloudProviderParameters">
            A valid Cloud Provider needs to be selected in order to deploy this application
          </alert>
          <button type="button" class="btn btn-primary btn-sm" 
            [disabled]="!repo.cloudProviderParametersService.currentlySelectedCloudProviderParameters"
            (click)="repo.deployApplication(applicationDeployer)">
              DEPLOY
          </button>
        </div>
      </div>
      </div>
    </accordion-group>

    <!--Shared applications-->
    <accordion-group *ngFor="let applicationDeployer of repo.sharedApplicationDeployers | applicationCloudProvider:cloudProviderFilters" 
      [isOpen]="openOne==applicationDeployer.name+'-shared'"
      (click)="openOne=applicationDeployer.name+'-shared'"
      heading="{{ applicationDeployer.name }} v{{ applicationDeployer.version }} SHARED">
      <div class="row">
        <div class="col-md-12">
          <p class="lead">{{ applicationDeployer.about }}</p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <h5>Source</h5>
          <p><a href="{{ applicationDeployer.repoUri }}">{{ applicationDeployer.repoUri }}</a></p>
          <h5>Version</h5>
          <p>{{ applicationDeployer.version }}</p>
          <h5>Contact</h5>
          <p>{{ applicationDeployer.contact }}</p>       
        </div>
        <div class="col-md-4">
          <h5>Available for</h5>
          <p class="param-value" *ngFor="let cloudProvider of applicationDeployer.cloudProviders">
            {{ cloudProvider.cloudProvider }}
          </p>
        </div>
        <div class="col-md-4">
          <h5>Owned by</h5>
          <p>{{ applicationDeployer.accountEmail }}</p>
          <span *ngIf="applicationDeployer.sharedWithTeamNames && applicationDeployer.sharedWithTeamNames.length>0">
            <h5>Included in teams</h5>
            <p *ngFor="let teamName of applicationDeployer.sharedWithTeamNames">
              {{ teamName }}
            </p>
          </span>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4">
          <h5>Volumes</h5>
          <p *ngIf="applicationDeployer.volumes.length==0">This application requires no data volumes</p>
          <div *ngFor="let aVolume of applicationDeployer.volumes">
            {{ aVolume }}
            <select class="form-control" 
              (change)="repo.attachVolume(applicationDeployer, aVolume, $event.target.value)">
              <option value="null">None</option>
              <option *ngFor="let volumeInstance of repo.volumeInstances">
                {{ volumeInstance.reference }}</option>
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <h5>Inputs</h5>
          <p *ngIf="applicationDeployer.inputs.length==0">This application defines no inputs</p>
          <div *ngFor="let anInput of applicationDeployer.inputs">
            <input class="form-control" 
              placeholder="{{anInput}}"
              (keyup.enter)="repo.assignInput(applicationDeployer, anInput, $event.target.value)"
              (blur)="repo.assignInput(applicationDeployer, anInput, $event.target.value)">
          </div>
        </div>
        <div class="col-md-4">
          <h5>Outputs</h5>
          <p *ngIf="applicationDeployer.outputs.length==0">This application defines no outputs</p>
          <div *ngFor="let anOutput of applicationDeployer.outputs">
            <p>{{anOutput}}</p>
          </div>
        </div> 
      </div>
      <br/>
      <div class="row">
      <div class="col-md-12">
        <div *ngIf="!applicationDeployer.deploying && !applicationDeployer.destroying">
          <alert type="warning" *ngIf="!repo.cloudProviderParametersService.currentlySelectedCloudProviderParameters">
            A valid Cloud Provider needs to be selected in order to deploy this application
          </alert>
          <button type="button" class="btn btn-primary btn-sm" 
            [disabled]="!repo.cloudProviderParametersService.currentlySelectedCloudProviderParameters"
            (click)="repo.deployApplication(applicationDeployer)">
              DEPLOY
          </button>
        </div>
      </div>
      </div>
    </accordion-group>

  </accordion>

</cp-repository-component>