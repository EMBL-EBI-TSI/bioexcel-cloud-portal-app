<cp-repository-component #repo>
  <button class="add-app-button btn btn-primary btn-sm" (click)="repo.addApplicationFormShowing=!repo.addApplicationFormShowing">
    <span class="glyphicon glyphicon-plus"></span>
  </button>

  <div *ngIf="repo.addApplicationFormShowing">
    <form [formGroup]="repo.applicationForm" autocomplete="off">
      <h3>Add application</h3>
      <div class="form-group">
        <label for="inputUri" class="sr-only">URI</label>
        <input class="form-control" id="inputUri" 
          type="url" placeholder="Repository URI" [formControl]="repo.applicationForm.controls['repoUri']" autofocus>
      </div>
      <button type="submit" class="btn btn-default"
      [disabled]="repo.applicationForm.controls['repoUri'].hasError('required') || !repo.applicationForm.controls['repoUri'].valid"
      (click)="repo.addApplication(repo.applicationForm.value); repo.addApplicationFormShowing = false">Add</button>
    </form>
    <br/>
  </div>

  <accordion [closeOthers]="true" *ngIf="repo.applicationDeployers">

    <div *ngIf="repo.applicationDeployers.length==0">
      No applications registered yet
    </div>

    <accordion-group *ngFor="let applicationDeployer of repo.applicationDeployers" heading="{{ applicationDeployer.name }} v{{ applicationDeployer.version }}">
      <p>{{ applicationDeployer.about }}</p>
      <h5>Source</h5>
      <p><a href="{{ applicationDeployer.repoUri }}">{{ applicationDeployer.repoUri }}</a></p>
      <h5>Version</h5>
      <p>{{ applicationDeployer.version }}</p>
      <h5>Contact</h5>
      <p>{{ applicationDeployer.contact }}</p>
      <h5>Available for</h5>
      <p class="param-value" *ngFor="let cloudProvider of applicationDeployer.cloudProviders">
        {{ cloudProvider.cloudProvider }}
      </p>

      <span *ngIf="!applicationDeployer.isShared && applicationDeployer.sharedWithAccountEmails.length>0">
        <h5>Shared with</h5>
        <p *ngFor="let accountEmail of applicationDeployer.sharedWithAccountEmails">
          {{ accountEmail }}
          <button (click)="repo.unshare(applicationDeployer, accountEmail)">
          <span class="glyphicon glyphicon-remove"></span>
        </button></p>
      </span>

      <h5>Volumes</h5>
      <p *ngIf="applicationDeployer.volumes.length==0">This application requires no data volumes</p>
      <div *ngFor="let aVolume of applicationDeployer.volumes">
        {{ aVolume }}
        <select class="form-control" 
          (change)="repo.attachVolume(applicationDeployer, aVolume, $event.target.value)">
          <option value="null">None</option>
          <option *ngFor="let volumeInstance of repo.volumeInstances">
            {{ volumeInstance.reference }}</option>
        </select>
      </div>
      <span *ngIf="applicationDeployer.deploying || applicationDeployer.destroying" mode="indeterminate">Working...</span>
      <br/>
      <div *ngIf="!applicationDeployer.deploying && !applicationDeployer.destroying">
        <button *ngIf="repo.cloudProviderParametersService.currentlySelectedCloudProviderParameters"
          type="button" class="btn btn-primary btn-sm" 
          (click)="repo.deployApplication(applicationDeployer)">
            DEPLOY
        </button>
        <alert type="warning" *ngIf="!repo.cloudProviderParametersService.currentlySelectedCloudProviderParameters">
          A valid Cloud Provider needs to be selected in order to deploy this application
        </alert>
        <button *ngIf="!repo.cloudProviderParametersService.currentlySelectedCloudProviderParameters" 
          type="button" class="btn btn-primary btn-sm" 
          disabled>
            DEPLOY
        </button>
      </div>
    </accordion-group>
  </accordion>

</cp-repository-component>